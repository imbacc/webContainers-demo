var B=Object.defineProperty;var Y=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>(Y(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var S=Symbol("Comlink.proxy"),$=Symbol("Comlink.endpoint"),x=Symbol("Comlink.releaseProxy"),P=Symbol("Comlink.thrown"),j=e=>typeof e=="object"&&e!==null||typeof e=="function",J={canHandle:e=>j(e)&&Boolean(e[S]),serialize(e){const{port1:t,port2:r}=new MessageChannel,s=e[S];return W(e,t,typeof s=="object"?s:void 0),[r,[r]]},deserialize(e){return e.start(),N(e)}},G={canHandle:e=>j(e)&&P in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},D=new Map([["proxy",J],["throw",G]]);function W(e,t=self,r){t.addEventListener("message",function s(n){if(!n||!n.data)return;const{id:o,type:a,path:c}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(g);let l;try{const f=(r==null?void 0:r.spec)==null;let m=e,d=e,p=r==null?void 0:r.spec,h=p;for(const i of c){if(m=d,h=p,f){d=d[i];continue}if(typeof p=="object"&&p.hasOwnProperty(i))d=d[i],p=p[i];else{d=void 0,p=void 0;break}}switch(a){case 0:l=d;break;case 1:{l=!1;const i=(r==null?void 0:r.set)!==!1,y=f||h==="primitive"||p==="primitive";y||(m=void 0),(i||!y)&&(m[c.slice(-1)[0]]=g(n.data.value),l=!0)}break;case 2:f||p==="function"||(d=void 0),l=d.apply(m,u);break;case 3:{f||(d=void 0);const i=new d(...u);l=O(i)}break;case 4:{const{port1:i,port2:y}=new MessageChannel;W(e,y,r),l=k(i,[i])}break;case 5:l=void 0;break}}catch(f){l={value:f,[P]:0}}Promise.resolve(l).catch(f=>({value:f,[P]:0})).then(f=>{const[m,d]=C(f);t.postMessage(Object.assign(Object.assign({},m),{id:o}),d),a===5&&(t.removeEventListener("message",s),U(t))})}),t.start&&t.start()}function K(e){return e.constructor.name==="MessagePort"}function U(e){K(e)&&e.close()}function N(e,t){return L(e,[],t)}function v(e){if(e)throw new Error("Proxy has been released and is not useable")}function L(e,t=[],r=function(){}){let s=!1;const n=new Proxy(r,{get(o,a){if(v(s),a===x)return()=>w(e,{type:5,path:t.map(c=>c.toString())}).then(()=>{U(e),s=!0});if(a==="then"){if(t.length===0)return{then:()=>n};const c=w(e,{type:0,path:t.map(u=>u.toString())}).then(g);return c.then.bind(c)}return L(e,[...t,a])},set(o,a,c){v(s);const[u,l]=C(c);return w(e,{type:1,path:[...t,a].map(f=>f.toString()),value:u},l).then(g)},apply(o,a,c){v(s);const u=t[t.length-1];if(u===$)return w(e,{type:4}).then(g);if(u==="bind")return L(e,t.slice(0,-1));const[l,f]=I(c);return w(e,{type:2,path:t.map(m=>m.toString()),argumentList:l},f).then(g)},construct(o,a){v(s);const[c,u]=I(a);return w(e,{type:3,path:t.map(l=>l.toString()),argumentList:c},u).then(g)}});return n}function X(e){return Array.prototype.concat.apply([],e)}function I(e){const t=e.map(C);return[t.map(r=>r[0]),X(t.map(r=>r[1]))]}var q=new WeakMap;function k(e,t){return q.set(e,t),e}function O(e,t){return Object.assign(e,{[S]:t??!0})}function C(e){for(const[t,r]of D)if(r.canHandle(e)){const[s,n]=r.serialize(e);return[{type:3,name:t,value:s},n]}return[{type:0,value:e},q.get(e)||[]]}function g(e){switch(e.type){case 3:return D.get(e.name).deserialize(e.value);case 0:return e.value}}function w(e,t,r){return new Promise(s=>{const n=Q();e.addEventListener("message",function o(a){!a.data||!a.data.id||a.data.id!==n||(e.removeEventListener("message",o),s(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function Q(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function H(e){const t={d:{}};for(const r of Object.keys(e)){const s=e[r];if("file"in s){const o=s.file.contents,a=typeof o=="string"?o:Z(o),c=typeof o=="string"?{}:{b:!0};t.d[r]={f:{c:a,...c}};continue}const n=H(s.directory);t.d[r]=n}return t}function Z(e){let t="";for(const r of e)t+=String.fromCharCode(r);return t}var ee="https://stackblitz.com/headless",_=null,M=!1,T=!1,te=new TextDecoder,re=new TextEncoder,V=class{constructor(e,t,r){b(this,"fs");this._endpoint=e,this._iframe=r,this.fs=new ie(t)}async spawn(e,t,r){let s=[];Array.isArray(t)?s=t:r=t;let n=new ReadableStream,o;(r==null?void 0:r.output)!==!1&&(n=new ReadableStream({start(u){o=l=>u.enqueue(l)}}));const a=fe(le(o)),c=await this._endpoint.run({command:e,args:s,env:r==null?void 0:r.env,terminal:r==null?void 0:r.terminal},void 0,void 0,a);return new ae(c,n)}on(e,t){let r=!1,s=()=>{};const n=(...o)=>{r||t(...o)};return this._endpoint.on(e,O(n)).then(o=>{s=o,r&&s()}),()=>{r=!0,s()}}mount(e,t){const r=re.encode(JSON.stringify(H(e)));return this._endpoint.loadFiles(k(r,[r.buffer]),{mountPoints:t==null?void 0:t.mountPoint})}teardown(){if(T)throw new Error("WebContainer already torn down");T=!0,this.fs._teardown(),this._endpoint.teardown(),this._endpoint[x](),this._iframe.remove()}static async boot(){for(;_;)await _;if(M)throw new Error("WebContainer already booted");const e=ce();_=e.catch(()=>{});try{const t=await e;return M=!0,t}finally{_=null}}},ne=1,se=2,oe=class{constructor(e,t){this.name=e,this._type=t}isFile(){return this._type===ne}isDirectory(){return this._type===se}},ae=class{constructor(e,t){b(this,"input");this._process=e,this.output=t,this.input=new WritableStream({write:r=>{this._process.write(r).catch(()=>{})}})}get exit(){return this._process.onExit}kill(){this._process.kill()}resize(e){this._process.resize(e)}},ie=class{constructor(e){b(this,"_fs");this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async writeFile(e,t,r){if(t instanceof Uint8Array){const s=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=k(new Uint8Array(s),[s])}await this._fs.writeFile(e,t,r)}async readdir(e,t){const r=await this._fs.readdir(e,t);return de(r)||pe(r)?r:r.map(n=>new oe(n.name,n["Symbol(type)"]))}async mkdir(e,t){return await this._fs.mkdir(e,t)}_teardown(){this._fs[x]()}};async function ce(){const{iframe:e,endpointPromise:t}=ue(),r=await t,s=await r.build({host:window.location.host,version:"1.0.2"}),n=await s.fs();return r[x](),new V(s,n,e)}function le(e){if(e!=null)return t=>{t instanceof Uint8Array&&e(te.decode(t))}}function fe(e){if(e!=null)return O(e)}function ue(){const e=document.createElement("iframe");e.style.display="none",e.setAttribute("allow","cross-origin-isolated");const t=R();e.src=R().toString();const{origin:r}=t,s=new Promise(n=>{const o=a=>{if(a.origin!==r)return;const{data:c}=a;if(c.type==="init"){n(N(a.ports[0]));return}if(c.type==="warning"){console[c.level].call(console,c.message);return}};window.addEventListener("message",o)});return document.body.insertBefore(e,null),{iframe:e,endpointPromise:s}}function de(e){return typeof e[0]=="string"}function pe(e){return e[0]instanceof Uint8Array}function R(){return new URL(window.WEBCONTAINER_API_IFRAME_URL??ee)}const me=`import express from 'express'\r
\r
const app = express()\r
const port = 3111\r
\r
app.get('/', (req, res) => {\r
  res.send('Welcome to a WebContainers app! ðŸ¥³')\r
})\r
\r
app.listen(port, () => {\r
  console.log(\`App is live at http://localhost:\${port}\`)\r
})\r
`,ye=`{\r
  "name": "example-app",\r
  "type": "module",\r
  "dependencies": {\r
    "express": "latest",\r
    "nodemon": "latest"\r
  },\r
  "scripts": {\r
    "start": "nodemon --watch './' index.js"\r
  }\r
}\r
`,z=Object.assign({"../containers/index.js":me,"../containers/package.json":ye}),ge=()=>{const e=Object.keys(z),t={};for(const r of e)t[r.replace("../containers/","")]={file:{contents:z[r]}};return t};async function E(e,t,r=[]){const s=await e.spawn(t,r),n=await s.exit;return[s,n,a=>{s.output.pipeTo(new WritableStream({write(c){a==null||a(c)}}))}]}async function we(e,t){await e.fs.writeFile("/index.js",t)}const he=async()=>{const e=await ge();console.log("%c [ files ]-18","font-size:14px; background:#41b883; color:#ffffff;",e);const t=document.querySelector("iframe"),r=document.querySelector("textarea"),s=document.querySelector(".log"),n=o=>{const a=document.createElement("p");a.innerText=o,s.appendChild(a)};window.addEventListener("load",async()=>{const o=await V.boot();await o.mount(e),r.value=e["index.js"].file.contents,r.addEventListener("input",i=>{var y,A,F;console.log("%c [ e ]-79","font-size:14px; background:#41b883; color:#ffffff;",(y=i==null?void 0:i.target)==null?void 0:y.value),we(o,((A=i==null?void 0:i.currentTarget)==null?void 0:A.value)||((F=i==null?void 0:i.target)==null?void 0:F.value))}),o.on("server-ready",(i,y)=>{console.log("%c [ port ]-58","font-size:14px; background:#41b883; color:#ffffff;",i),console.log("%c [ url ]-58","font-size:14px; background:#41b883; color:#ffffff;",y),t.src=y});const[a,c,u]=await E(o,"ls",["-l"]);console.log("%c [ lsState ]-66","font-size:14px; background:#41b883; color:#ffffff;",c),n(`ls------------------------${c}`),u(i=>{console.log(i),n(i)});const[l,f,m]=await E(o,"npm",["install"]);console.log("%c [ installDepState ]-51","font-size:14px; background:#41b883; color:#ffffff;",f),n(`installDepOut------------------------installDepState=${f}`),m(i=>{console.log(i),n(i)});const[d,p,h]=await E(o,"npm",["run","start"]);console.log("%c [ runState ]-59","font-size:14px; background:#41b883; color:#ffffff;",p),n(`runOut------------------------runState=${p}`),h(i=>{console.log(i),n(i)})})};document.querySelector("#app").innerHTML=`
  <div class="container">
    <div class="editor">
      <textarea>I am a textarea</textarea>
    </div>
    <div class="preview">
      <iframe src=""></iframe>
    </div>
  </div>
  <div class="log"></div>
`;he();
